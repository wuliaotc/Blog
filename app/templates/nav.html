<nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="#">Blog</a>
        </div>
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/index">Home</a>
                </li>
            </ul>
        </div>
        <div class="navbar-right">
            {% if context.is_login %}
            <div class="nav navbar-nav" id="login_true">
                <div  class="dropdown dropleft"> 
                    <!--userinfo-->
                    
                    <a class="dropdown-toggle" data-toggle="dropdown" id='userInfo' href="javascript:void(0);">{{context.USN}}</a>
                    <div class="dropdown-menu" style="background: #FFFFFF;width: 320px;overflow: hidden">
                        <div style="margin-top: 16px;border-bottom: 1px solid #eeeeee">
                            <div style="text-align: center">
                                <img class="img-circle" src={{context.avator}} style="width: 38px;height: 38px;" />
                            </div>
                            <div style="color: #323534;text-align: center;line-height: 36px;font-size: 15px">
                                <span>{{context.USN}}</span>
                            </div>
                        </div>

                        <div class="row" style="margin-left: 15px;margin-right: 15px;margin-top: 10px">
                            <div class="col-md-4 text-center grid" onclick="var newWeb=window.open('_blank');newWeb.location='/userinfo';">
                                <i class="fa fa-user" style="font-size: 25px;line-height: 45px;"></i>
                                <p style="padding: 0px;margin-top: 6px;margin-bottom: 10px;font-size: 12px">
                                    个人中心</p>
                            </div>
                            <div class="col-md-4 text-center grid">
                                <i class="fa fa-gear" style="font-size: 25px;line-height: 45px;"></i>
                                <p style="padding: 0px;margin-top: 6px;margin-bottom: 10px;font-size: 12px">
                                    账号管理</p>
                            </div>
                            <div class="col-md-4 text-center grid" data-toggle="modal" data-target="#changePassword" href="javascript:void(0);">
                                <i class="fa fa-key" style="font-size: 25px;line-height: 45px;"></i>
                                <p style="padding: 0px;margin-top: 6px;margin-bottom: 10px;font-size: 12px">
                                    密码修改</p>
                            </div>
                        </div>

                        <div class="row" style="margin-left: 15px;margin-right: 15px;margin-top: 10px" data-toggle="modal"  data-target="#changeAvator" href="javascript:void(0);" >
                            <div class="col-md-4 text-center grid">
                                <i class="fa fa-user-circle" style="font-size: 25px;line-height: 45px;"></i>
                                <p style="padding: 0px;margin-top: 6px;margin-bottom: 10px;font-size: 12px">
                                    修改头像</p>
                            </div>
                            <div class="col-md-4 text-center grid">
                                <i class="fa fa-comments" style="font-size: 25px;line-height: 45px;"></i>
                                <p style="padding: 0px;margin-top: 6px;margin-bottom: 10px;font-size: 12px">
                                    消息</p>
                            </div>
                            <div class="col-md-4 text-center grid">
                                <i class="fa fa-heart-o" style="font-size: 25px;line-height: 45px;"></i>
                                <p style="padding: 0px;margin-top: 6px;margin-bottom: 10px;font-size: 12px">
                                    帮助中心</p>
                            </div>
                        </div>


                        <div class="row" style="margin-top: 20px">
                            <div class="col-md-12 text-center" style="padding: 15px;margin: 0px;background: #f6f5f5;color: #323534;">
                                <i class="fa fa-sign-out"></i> 
                                <a data-toggle="modal" data-target="#logout" href="javascript:void(0);">注销</a>
                            </div>
                        </div>
                    </div>
                    <a target="_blank" href="/write">写博客</a>
                </div>
                
            </div>

            {% else %}
            <div class="nav navbar-nav" id="login_false" n>
                <a data-toggle="modal" data-target="#register" href="javascript:void(0);">注册</a>
                <a data-toggle="modal" data-target="#login" href="javascript:void(0);">登录</a>
            </div>

            {% endif %}
        </div>
    </div>
</nav>

<!--Register Modal -->
<div class="modal fade" id="register" tabindex="-1" role="dialog" aria-labelledby="#register_label" aria-hidden="true">
    <!--半透明的遮罩层-->
    <div class="modal-dialog" role="document">
        <!--尺寸和定位-->
        <div class="modal-content">
            <!--背景/边框/倒角/阴影-->
            <div class="modal-header">
                <h5 class="modal-title" id="register_label">注册</h5>
                <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>-->
            </div>
            <div class="modal-body">
                <form class="form-group" action="../register/" method="POST">
                    <div class="form-group">
                        <label for="">用户名</label>
                        <input class="form-control" name="USN" type="text" placeholder="请输入你的昵称">
                    </div>
                    <div class="form-group">
                        <label for="">密码</label>
                        <input class="form-control" name="PWD" type="password" placeholder="至少8位字母符号或数字">
                    </div>
                    <div class="form-group">
                        <label for="">再次输入密码</label>
                        <input class="form-control" name="rePWD" type="password" placeholder="至少8位字母符号或数字">
                    </div>
                    <div class="form-group">
                        <label for="">邮箱</label>
                        <input class="form-control" name="Email" type="email" placeholder="例如:123@123.com">
                    </div>
                    <div class="text-right">
                        <button class="btn btn-primary" type="submit">提交</button>
                        <button class="btn btn-danger" data-dismiss="modal">取消</button>
                    </div>
                    <a href="javascript:void(0);" data-toggle="modal" data-dismiss="modal" data-target="#login">已有账号？点我登录</a>
                </form>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
<!--Login Modal -->
<div class="modal fade" id="login">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <!--<button class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>-->
            </div>
            <div class="modal-title">
                <h1 class="text-center">登录</h1>
            </div>
            <div class="modal-body">
                <form class="form-group" action="../login/" method="POST">
                    <div class="form-group">
                        <label for="">用户名</label>
                        <input class="form-control" name="USN" type="text" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="">密码</label>
                        <input class="form-control" name="PWD" type="password" placeholder="">
                    </div>
                    <div class="text-right">
                        <button class="btn btn-primary" type="submit">登录</button>
                        <button class="btn btn-danger" data-dismiss="modal">取消</button>
                    </div>
                    <a href="" data-toggle="modal" data-dismiss="modal" data-target="#register">还没有账号？点我注册</a>
                </form>
            </div>
        </div>
    </div>
</div>
<!--Logout Modal -->
<div class="modal fade" id="logout" tabindex="-1" role="dialog" aria-labelledby="#logout_label" aria-hidden="true">
    <!--半透明的遮罩层-->
    <div class="modal-dialog" role="document">
        <!--尺寸和定位-->
        <div class="modal-content">
            <!--背景/边框/倒角/阴影-->
            <div class="modal-header">
                <h5 class="modal-title" id="logout_label">确认注销</h5>
                <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>-->
            </div>
            <div class="modal-body">
                <p>是否注销?注销会导致保存在本地的一切数据被清除,你的账号也会被退出</p>
            </div>
            <div class="modal-footer">
                <a href="../logout/" class="btn btn-primary">注销</a>
                <button class="btn btn-danger" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>
<!--ChangePassword Modal -->
<div class="modal fade" id="changePassword">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <!--<button class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>-->
            </div>
            <div class="modal-title">
                <h1 class="text-center">修改密码</h1>
            </div>
            <div class="modal-body">
                <form class="form-group" action="../changePassword/" method="POST">
                    <div class="form-group">
                        <label for="">密码</label>
                        <input class="form-control" name="PWD" type="password" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="">请再次输入密码</label>
                        <input class="form-control" name="rePWD" type="password" placeholder="">
                    </div>
                    <div class="text-right">
                        <button class="btn btn-primary" type="submit">确认修改</button>
                        <button class="btn btn-danger" data-dismiss="modal">取消</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!--change avator-->
<div class="modal fade" id="changeAvator">
    <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-title">
                    <h3 class="text-center">修改头像</h3>
                </div>
                <div class"modal-body">
                    <div class="col-md-10 tl th">
                        <input id="avatorUpload" type="file" name="editormd-image-file" class="file-loading">
                        <p class="help-block">支持jpg、jpeg、png等格式，大小不超过2.0M</p>
                    </div>
                </div>	
                <div class="form-group text-center ">
                    <div class="col-md-10 col-md-offset-1">
                        <button type="submit" class="btn btn-primary btn-lg">保存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
$(function () {
        //0.初始化fileinput
        var oFileInput = new FileInput();
        oFileInput.Init("avatorUpload", "/uploadImage");
    });
    var FileInput = function () {
        var oFile = new Object();

        //初始化fileinput控件（第一次初始化）
        oFile.Init = function (ctrlName, uploadUrl) {
            var control = $('#' + ctrlName);

            //初始化上传控件的样式
            control.fileinput({
                language: 'zh', //设置语言
                uploadUrl: uploadUrl, //上传的地址
                allowedFileExtensions: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],//接收的文件后缀
                //showUploadedThumbs:false,
                // uploadClass: 'hidden',
                showUpload: false, //是否显示上传按钮
                showCaption: false,//是否显示标题
                showPreview:true,
                browseClass: "btn btn-info", //按钮样式
                dropZoneEnabled: false,//是否显示拖拽区域
                //minImageWidth: 150, //图片的最小宽度
                //minImageHeight: 150,//图片的最小高度
                //maxImageWidth: 150,//图片的最大宽度
                //maxImageHeight: 150,//图片的最大高度
                maxFileSize: 2048,//单位为kb，如果为0表示不限制文件大小
                maxFileCount: 1, //表示允许同时上传的最大文件个数
                minFileCount: 1,
                enctype: 'multipart/form-data',
                validateInitialCount: true,
                previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
                msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
                fileActionSettings : {
                    showUpload: false,
                    //showRemove: false
                   showZoom:false
                }
            });

            //导入文件上传完成之后的事件
            $("#avatorUpload").on("fileuploaded", function (event, data, previewId, index) {
                alert(data.response.code);
                // $("#divControl").hide();
            });
        }
        return oFile;
    };
</script>
<script>
    function checkPassword(pwd) {
            if (pwd.length < 8) {//小于8
                alert("长度不可小于八位")
                return false;
            }
            if (pwd == $('#USN').val()) {
                alert("密码不能与昵称相同")
                return false;
            }
            var modes = 0;
            if (/\d/.test(pwd)) modes++; //数字
            if (/[a-zA-Z]/.test(pwd)) modes++; //小写或小写
            if (/[A-Z][a-z]|[a-z][A-Z]/.test(pwd)) modes++; //大写且有小写
            if (/\W/.test(pwd)) modes++; //特殊字符
            if (modes > 1) {
                return true;
            }
            alert("密码强度不足");
            return false;
        }
</script>

    <link href="../static/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css"/>
    <link href="../static/themes/explorer-fas/theme.css" media="all" rel="stylesheet" type="text/css"/>
    <script src="../static/js/plugins/piexif.js" type="text/javascript"></script>
    <script src="../static/js/plugins/sortable.js" type="text/javascript"></script>
    <script src="../static/js/fileinput.min.js" type="text/javascript"></script>
    <script src="../static/js/locales/fr.js" type="text/javascript"></script>
    <script src="../static/js/locales/es.js" type="text/javascript"></script>
    <script src="../static/themes/fas/theme.js" type="text/javascript"></script>
    <script src="../static/themes/explorer-fas/theme.js" type="text/javascript"></script>
